# Step by step tutorial, how to use this repository to configure your own CI/CD Powershell repository in your own environment

## ! test in separate environment before deploy to production !

ceska verze [wug slides](https://github.com/ztrhgf/Powershell_CICD_repository/blob/master/jak%20zprovoznit%20CICD%20Powershell%20repo.pptx))


# Prerequisities
- Active Directory
  - create and link GPO
  - create 2 groups
- one shared folder (DFS preferably)
- one private GIT repository (preferably in Azure DevOps), can be hosted locally also 
- possibility to install GIT and Visual Studio Code on admin PC and GIT on dedicated server
- tested with Powershell 5.1 (but Powershell 3.0 should be fine also)

# Notions list
- PS = Powershell
- AD = Active Directory 
- Repo = repository
- Cloned repo = local copy of your company CI/CD GIT repository
- Cloud repo = GIT repository that hosts your company CI/CD repository (Azure DevOps, GitHub or local GIT repo server)
- DFS repository = shared folder (preferably in DFS), to which MGM server copy processed repository data. And it is therefore source of data for clients in AD.
- MGM server = server, which is intended for processing of GIT repository data (clone, process and copy to DFS share)
- repo_puller = GIT read only account intended for cloning the repository to MGM server


# To set up, please follow these steps 
## In cloud repo (Azure DevOps)
- Create private GIT repository (for security reasons choose name, which doesn't refer to your company)
- Create read-only account repo_puller, intended for cloning repo to MGM server
  - create "Alternate Credentials" for this account (nonexpiring credentials which will be than stored in login.xml)
    - Alternate Credentials can be created in Security menu
- You can invite your colleagues (in Azure DevOps free plan can contains max 5 accounts!)

## In Active Directory
- create 2 security groups
  - repo_reader – with members: domain computers, domain controllers
  - repo_writer – with members: domain admins and computer account of MGM server
  - (you have to restart computers to apply this change of membership)

## Create shared folder (in DFS preferably)
- something like \\moyDomain\dfs\repository
- set these exclusive rights
  - Share permission
    - Everyone FULL CONTROL
  - NTFS permission
    - System FULL CONTROL
    - repo_writer FULL CONTROL
    - repo_reader READ
    
## On your computer (where you will manage GIT repository content)
- Install [VSC](https://code.visualstudio.com/download)
- Install [GIT](https://git-scm.com/download/win)
- clone your company cloud repository
  - git clone https://yourRepoUrl
- to different folder clone this repository (don't use Download ZIP!)
  - git clone https://github.com/ztrhgf/Powershell_CICD_repository.git
- copy **content of** repo_content_set_up folder from this cloned repository to **root** of your company cloud repository
- **follow the steps in !!!README!!!.txt** (now stored in root of your company repo) to set up automation
- copy module PSScriptAnalyzer from "cloned repo\Modules" to C:\Windows\System32\WindowsPowerShell\v1.0\Modules
- close and reopen VSC
- in VSC
  - open folder with cloned repo
  - accept installation of recommended addons
  TODO
